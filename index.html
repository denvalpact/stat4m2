<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Match Statistics Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            font-size: 10px;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .form-container {
            width: 100%;
            max-width: 1100px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .match-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .team-info {
            display: flex;
            gap: 10px;
        }
        
        .columns-container {
            display: flex;
            width: 100%;
            gap: 10px;
        }
        
        .team-column {
            width: 50%;
            box-sizing: border-box;
        }
        
        .team-a-column {
            padding-right: 5px;
        }
        
        .team-b-column {
            padding-left: 5px;
        }
        
        .stat-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            margin-bottom: 10px;
        }
        
        .stat-table, .stat-table th, .stat-table td {
            border: 1px solid black;
        }
        
        .stat-table th, .stat-table td {
            padding: 3px;
            text-align: center;
            height: 20px;
        }
        
        .stat-table td {
            cursor: pointer;
        }
        
        .small-col {
            width: 20px;
        }
        
        .medium-col {
            width: 25px;
        }
        
        .name-col {
            width: 70px;
        }
        
        .team-a {
            background-color: #e6f7ff;
        }
        
        .team-b {
            background-color: #fff2e6;
        }
        
        .controls {
            margin: 10px 0;
            padding: 5px;
            border: 1px solid #ddd;
        }
        
        select, input, button {
            font-size: 10px;
            padding: 3px;
            margin-right: 5px;
        }
        
        button {
            cursor: pointer;
        }
        
        .team-title {
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            font-size: 12px;
        }
        
        .player-controls {
            display: flex;
            gap: 5px;
            margin-top: 2px;
        }
        
        .player-controls button {
            padding: 1px 3px;
            font-size: 8px;
        }
        
        .active-period {
            background-color: #ffeb3b;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .suspension-active {
            background-color: #ffcdd2;
        }
        
        .red-card {
            background-color: #ff0000;
            color: white;
            font-weight: bold;
        }
        
        .yellow-card {
            background-color: #ffff00;
            font-weight: bold;
        }
        
        .timeout-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 5px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
        }
        
        .timeout-team {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .timeout-count {
            font-weight: bold;
            min-width: 20px;
            text-align: center;
        }
        
        .timeout-button {
            padding: 2px 5px;
            font-size: 9px;
        }
        
        .timeout-disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .timeout-active {
            background-color: #ffeb3b;
            font-weight: bold;
        }
        
        .timeout-timer {
            margin-left: 5px;
            font-weight: bold;
        }
        
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
        }
        .quick-actions {
            display: flex;
            gap: 5px;
        }

        .quick-action-btn {
            padding: 2px 5px;
            font-size: 9px;
            cursor: pointer;
        }
        .context-menu button {
            display: block;
            width: 100%;
            padding: 5px 10px;
            text-align: left;
            background: none;
            border: none;
            cursor: pointer;
        }
        
        .context-menu button:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="header">ENHANCED MATCH STATISTICS</div>
        
        <div class="match-info">
            <div class="team-info">
                <div><strong>Team A</strong> vs <strong>Team B</strong></div>
                <div><strong>Date:</strong> <span id="match-date">2023-11-15</span></div>
            </div>
            <div><strong>Match No.:</strong> <span id="match-number">10765</span></div>
        </div>
        
        <!-- Timeout Controls -->
        <div class="timeout-controls">
            <div class="timeout-team">
                <span>Team A Timeouts:</span>
                <span id="timeout-count-a" class="timeout-count">3</span>
                <button id="timeout-button-a" class="timeout-button">Call Timeout</button>
                <span id="timeout-timer-a" class="timeout-timer"></span>
            </div>
            <div class="timeout-team">
                <span>Team B Timeouts:</span>
                <span id="timeout-count-b" class="timeout-count">3</span>
                <button id="timeout-button-b" class="timeout-button">Call Timeout</button>
                <span id="timeout-timer-b" class="timeout-timer"></span>
            </div>
        </div>
        
        <div class="time-markers">
            <div id="period-1H">Half-time(30')</div>
            <div id="period-2H">End of 60'</div>
            <div id="period-ET1">1st extra time</div>
            <div id="period-ET2">2nd extra time</div>
        </div>
        
        <div class="controls">
            <span id="game-time" style="margin-left: 20px;">
            <strong>Time:</strong> 
            <span id="match-time">00:00</span>
            <span id="current-period" class="active-period">1H</span>
            </span>
            <button id="toggle-suspension" class="suspension-active">2' Suspension Active</button>
            <!-- Add these buttons to the controls div (right after the suspension button) -->
            <div class="quick-actions">
            <button id="undo-btn" class="quick-action-btn" title="Undo last action">↩ Undo</button>
            <button id="redo-btn" class="quick-action-btn" title="Redo last action">↪ Redo</button>
            </div>
        </div>
        
        <!-- Two Column Layout -->
        <div class="columns-container">
            <!-- Team A Column (Left) -->
            <div class="team-column team-a-column">
                <div class="team-title">TEAM A</div>
                <table class="stat-table" id="stats-table-a">
                    <thead>
                        <tr>
                            <th class="small-col">No.</th>
                            <th class="name-col">Name</th>
                            <th class="small-col">Shirt</th>
                            <th class="small-col">Goals</th>
                            <th class="small-col">Assists</th>
                            <th class="small-col">2'</th>
                            <th class="small-col">Yellow</th>
                            <th class="small-col">Red</th>
                            <th class="small-col">Steals</th>
                            <th class="small-col">Blocks</th>
                            <th class="small-col">Turnovers</th>
                        </tr>
                    </thead>
                    <tbody id="stats-body-a">
                        <!-- Rows will be added dynamically -->
                    </tbody>
                </table>
            </div>
            
            <!-- Team B Column (Right) -->
            <div class="team-column team-b-column">
                <div class="team-title">TEAM B</div>
                <table class="stat-table" id="stats-table-b">
                    <thead>
                        <tr>
                            <th class="small-col">No.</th>
                            <th class="name-col">Name</th>
                            <th class="small-col">Shirt</th>
                            <th class="small-col">Goals</th>
                            <th class="small-col">Assists</th>
                            <th class="small-col">2'</th>
                            <th class="small-col">Yellow</th>
                            <th class="small-col">Red</th>
                            <th class="small-col">Steals</th>
                            <th class="small-col">Blocks</th>
                            <th class="small-col">Turnovers</th>
                        </tr>
                    </thead>
                    <tbody id="stats-body-b">
                        <!-- Rows will be added dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="match-info" style="margin-top: 10px;">
            <div>
                <strong>Referees:</strong> 
                <span id="referee1">John Smith</span>, 
                <span id="referee2">Michael Johnson</span>
            </div>
            <div>
                <strong>City:</strong> <span id="city">Berlin</span>
            </div>
        </div>
    </div>

    <div class="context-menu" id="context-menu">
        <button id="increment-btn">Increment (+1)</button>
        <button id="decrement-btn">Decrement (-1)</button>
        <button id="reset-btn">Reset (0)</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sample player data (would be provided before match)
            const players = {
                A: [
                    { id: 1, name: "Player A1", number: 7, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 2, name: "Player A2", number: 9, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 3, name: "Player A3", number: 11, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 4, name: "Player A4", number: 12, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 5, name: "Player A5", number: 5, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 6, name: "Player A6", number: 8, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 7, name: "Player A7", number: 10, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 8, name: "Player A8", number: 13, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 9, name: "Player A9", number: 14, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 10, name: "Player A10", number: 15, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 11, name: "Player A11", number: 16, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 12, name: "Player A12", number: 17, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 13, name: "Player A13", number: 18, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 14, name: "Player A14", number: 19, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 15, name: "Player A15", number: 20, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 16, name: "Player A16", number: 21, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 }
                ],
                B: [
                    { id: 1, name: "Player B1", number: 1, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 2, name: "Player B2", number: 2, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 3, name: "Player B3", number: 3, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 4, name: "Player B4", number: 4, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 5, name: "Player B5", number: 5, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 6, name: "Player B6", number: 6, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 7, name: "Player B7", number: 7, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 8, name: "Player B8", number: 8, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 9, name: "Player B9", number: 9, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 10, name: "Player B10", number: 10, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 11, name: "Player B11", number: 11, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 12, name: "Player B12", number: 12, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 13, name: "Player B13", number: 13, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 14, name: "Player B14", number: 14, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 15, name: "Player B15", number: 15, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 16, name: "Player B16", number: 16, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 }
                ]
            };

            // Game state
            let gameState = {
                seconds: 0,
                period: '1H',
                isTwoMinuteSuspension: false,
                suspensionTeam: null,
                suspensionEndTime: 0,
                timeouts: {
                    A: 3,
                    B: 3
                },
                isTimeoutActive: false,
                timeoutTeam: null,
                timeoutStartTime: 0,
                timeoutEndTime: 0,
                timeoutTimer: null
            };

            // Context menu state
            let contextMenu = {
                element: null,
                currentCell: null,
                currentPlayer: null,
                currentStat: null
            };

            // Initialize tables with player data
            function initializeTables() {
                renderTeamTable('A');
                renderTeamTable('B');
                setupCellClickHandlers();
            }

            // Render team table
            function renderTeamTable(team) {
                const tbody = document.getElementById(`stats-body-${team.toLowerCase()}`);
                tbody.innerHTML = '';
                
                players[team].forEach((player, index) => {
                    const tr = document.createElement('tr');
                    if (player.redCard) {
                        tr.classList.add('red-card');
                    }
                    tr.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${player.name}</td>
                        <td>${player.number}</td>
                        <td class="stat-cell" data-stat="goals" data-player-id="${player.id}" data-team="${team}">${player.goals}</td>
                        <td class="stat-cell" data-stat="assists" data-player-id="${player.id}" data-team="${team}">${player.assists}</td>
                        <td class="stat-cell" data-stat="twoMinutes" data-player-id="${player.id}" data-team="${team}">${player.twoMinutes}</td>
                        <td class="stat-cell" data-stat="yellowCards" data-player-id="${player.id}" data-team="${team}" ${player.yellowCards > 0 ? 'class="yellow-card"' : ''}>${player.yellowCards}</td>
                        <td class="stat-cell" data-stat="redCard" data-player-id="${player.id}" data-team="${team}">${player.redCard ? 'X' : ''}</td>
                        <td class="stat-cell" data-stat="steals" data-player-id="${player.id}" data-team="${team}">${player.steals}</td>
                        <td class="stat-cell" data-stat="blocks" data-player-id="${player.id}" data-team="${team}">${player.blocks}</td>
                        <td class="stat-cell" data-stat="turnovers" data-player-id="${player.id}" data-team="${team}">${player.turnovers}</td>
                    `;
                    tbody.appendChild(tr);
                });
            }

            // Setup click handlers for all stat cells
            function setupCellClickHandlers() {
                // Initialize context menu
                contextMenu.element = document.getElementById('context-menu');
                document.getElementById('increment-btn').addEventListener('click', handleIncrement);
                document.getElementById('decrement-btn').addEventListener('click', handleDecrement);
                document.getElementById('reset-btn').addEventListener('click', handleReset);

                // Close context menu when clicking elsewhere
                document.addEventListener('click', (e) => {
                    if (e.target.className !== 'stat-cell' && !contextMenu.element.contains(e.target)) {
                        contextMenu.element.style.display = 'none';
                    }
                });

                // Prevent default context menu
                document.addEventListener('contextmenu', (e) => {
                    if (e.target.className === 'stat-cell') {
                        e.preventDefault();
                    }
                });

                // Add click handlers to all stat cells
                document.querySelectorAll('.stat-cell').forEach(cell => {
                    // Left click - increment
                    cell.addEventListener('click', (e) => {
                        if (e.button === 0) { // Left click only
                            handleCellClick(cell, 1);
                        }
                    });

                    // Right click - context menu
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        showContextMenu(cell, e);
                    });

                    // Touch devices - long press for context menu
                    let pressTimer;
                    cell.addEventListener('touchstart', (e) => {
                        pressTimer = setTimeout(() => {
                            showContextMenu(cell, e);
                        }, 500); // 500ms for long press
                    });

                    cell.addEventListener('touchend', (e) => {
                        clearTimeout(pressTimer);
                    });

                    cell.addEventListener('touchmove', (e) => {
                        clearTimeout(pressTimer);
                    });
                });
            }

            // Handle cell click (increment)
            function handleCellClick(cell, increment) {
                const team = cell.getAttribute('data-team');
                const playerId = parseInt(cell.getAttribute('data-player-id'));
                const stat = cell.getAttribute('data-stat');
                const player = players[team].find(p => p.id === playerId);

                if (!player || player.redCard) return; // Can't update stats for players with red cards

                // Special handling for different stats
                switch(stat) {
                    case 'twoMinutes':
                        const newTwoMinutes = player.twoMinutes + increment;
                        if (newTwoMinutes >= 0 && newTwoMinutes <= 3) {
                            player.twoMinutes = newTwoMinutes;
                            cell.textContent = player.twoMinutes;
                            
                            // Check for red card (3 two-minute suspensions)
                            if (player.twoMinutes >= 3) {
                                player.redCard = true;
                                document.querySelector(`[data-stat="redCard"][data-player-id="${playerId}"][data-team="${team}"]`).textContent = 'X';
                                document.querySelector(`#stats-body-${team.toLowerCase()} tr:nth-child(${playerId})`).classList.add('red-card');
                                alert(`Player ${player.name} (${player.number}) received a red card for 3 two-minute suspensions!`);
                            }
                        }
                        break;
                        
                    case 'yellowCards':
                        const newYellowCards = player.yellowCards + increment;
                        if (newYellowCards >= 0 && newYellowCards <= 2) {
                            player.yellowCards = newYellowCards;
                            cell.textContent = player.yellowCards;
                            cell.classList.toggle('yellow-card', player.yellowCards > 0);
                            
                            // Check if player already has 2 yellow cards
                            if (player.yellowCards >= 2) {
                                alert(`Player ${player.name} (${player.number}) has received 2 yellow cards!`);
                            }
                        }
                        break;
                        
                    case 'redCard':
                        if (increment > 0) {
                            player.redCard = !player.redCard;
                            cell.textContent = player.redCard ? 'X' : '';
                            document.querySelector(`#stats-body-${team.toLowerCase()} tr:nth-child(${playerId})`).classList.toggle('red-card', player.redCard);
                        }
                        break;
                        
                    default:
                        const newValue = player[stat] + increment;
                        if (newValue >= 0) {
                            player[stat] = newValue;
                            cell.textContent = player[stat];
                        }
                        break;
                }
            }

            // Show context menu
            function showContextMenu(cell, event) {
                contextMenu.currentCell = cell;
                contextMenu.currentPlayer = {
                    team: cell.getAttribute('data-team'),
                    id: parseInt(cell.getAttribute('data-player-id')),
                    stat: cell.getAttribute('data-stat')
                };
                
                // Position the context menu
                contextMenu.element.style.display = 'block';
                contextMenu.element.style.left = `${event.clientX}px`;
                contextMenu.element.style.top = `${event.clientY}px`;
                
                // Prevent default for touch events
                if (event.type === 'touchstart') {
                    event.preventDefault();
                }
            }

            // Handle increment from context menu
            function handleIncrement() {
                handleCellClick(contextMenu.currentCell, 1);
                contextMenu.element.style.display = 'none';
            }

            // Handle decrement from context menu
            function handleDecrement() {
                handleCellClick(contextMenu.currentCell, -1);
                contextMenu.element.style.display = 'none';
            }

            // Handle reset from context menu
            function handleReset() {
                const player = players[contextMenu.currentPlayer.team].find(p => p.id === contextMenu.currentPlayer.id);
                const stat = contextMenu.currentPlayer.stat;
                
                if (player) {
                    // Special cases
                    if (stat === 'redCard') {
                        player.redCard = false;
                        contextMenu.currentCell.textContent = '';
                        document.querySelector(`#stats-body-${contextMenu.currentPlayer.team.toLowerCase()} tr:nth-child(${contextMenu.currentPlayer.id})`).classList.remove('red-card');
                    } else {
                        player[stat] = 0;
                        contextMenu.currentCell.textContent = '0';
                        
                        // Clear yellow card styling if resetting yellow cards
                        if (stat === 'yellowCards') {
                            contextMenu.currentCell.classList.remove('yellow-card');
                        }
                    }
                }
                
                contextMenu.element.style.display = 'none';
            }

            // Call a timeout for a team
            function callTimeout(team) {
                if (gameState.timeouts[team] <= 0) {
                    alert(`Team ${team} has no timeouts remaining!`);
                    return;
                }

                if (gameState.isTimeoutActive) {
                    alert('A timeout is already active!');
                    return;
                }

                // Start the timeout
                gameState.isTimeoutActive = true;
                gameState.timeoutTeam = team;
                gameState.timeouts[team]--;
                gameState.timeoutStartTime = gameState.seconds;
                gameState.timeoutEndTime = gameState.seconds + 60; // 60 seconds = 1 minute

                // Update UI
                document.getElementById(`timeout-count-${team}`).textContent = gameState.timeouts[team];
                document.getElementById(`timeout-button-${team}`).classList.add('timeout-disabled');
                document.getElementById(`timeout-button-${team === 'A' ? 'B' : 'A'}`).classList.add('timeout-disabled');
                document.getElementById(`timeout-button-${team}`).classList.add('timeout-active');

                // Start timeout timer
                gameState.timeoutTimer = setInterval(updateTimeoutTimer, 1000);
                updateTimeoutTimer();

                alert(`Team ${team} called a timeout (1 minute). Remaining timeouts: ${gameState.timeouts[team]}`);
            }

            // Update timeout timer display
            function updateTimeoutTimer() {
                if (!gameState.isTimeoutActive) return;

                const remainingSeconds = gameState.timeoutEndTime - gameState.seconds;
                if (remainingSeconds <= 0) {
                    endTimeout();
                    return;
                }

                const minutes = Math.floor(remainingSeconds / 60);
                const seconds = remainingSeconds % 60;
                document.getElementById(`timeout-timer-${gameState.timeoutTeam}`).textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }

            // End the current timeout
            function endTimeout() {
                if (!gameState.isTimeoutActive) return;

                clearInterval(gameState.timeoutTimer);
                gameState.isTimeoutActive = false;
                
                // Reset UI
                document.getElementById(`timeout-button-A`).classList.remove('timeout-disabled', 'timeout-active');
                document.getElementById(`timeout-button-B`).classList.remove('timeout-disabled', 'timeout-active');
                document.getElementById(`timeout-timer-A`).textContent = '';
                document.getElementById(`timeout-timer-B`).textContent = '';
                
                // If team has no timeouts left, disable their button
                if (gameState.timeouts['A'] <= 0) {
                    document.getElementById(`timeout-button-A`).classList.add('timeout-disabled');
                }
                if (gameState.timeouts['B'] <= 0) {
                    document.getElementById(`timeout-button-B`).classList.add('timeout-disabled');
                }

                alert(`Timeout for Team ${gameState.timeoutTeam} has ended. Game resumes.`);
                gameState.timeoutTeam = null;
            }

            // Update game time display
            function updateTimeDisplay() {
                const periodSeconds = gameState.seconds % 1800; // 30 minutes per period
                const minutes = Math.floor(periodSeconds / 60);
                const seconds = periodSeconds % 60;
                
                document.getElementById('match-time').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Update period based on time
                if (gameState.seconds < 1800) {
                    gameState.period = '1H';
                } else if (gameState.seconds < 3600) {
                    gameState.period = '2H';
                } else if (gameState.seconds < 3900) {
                    gameState.period = 'ET1';
                } else {
                    gameState.period = 'ET2';
                }
                
                updatePeriodHighlight();
                
                // Check if 2-minute suspension has ended
                if (gameState.isTwoMinuteSuspension && gameState.seconds >= gameState.suspensionEndTime) {
                    gameState.isTwoMinuteSuspension = false;
                    gameState.suspensionTeam = null;
                    updateSuspensionButton();
                }
                
                // Update timeout timer if active
                if (gameState.isTimeoutActive) {
                    updateTimeoutTimer();
                }
            }
            
            // Highlight current period
            function updatePeriodHighlight() {
                document.querySelectorAll('.time-markers div').forEach(el => {
                    el.classList.remove('active-period');
                });
                document.getElementById(`period-${gameState.period}`).classList.add('active-period');
                document.getElementById('current-period').textContent = gameState.period;
            }
            
            // Update suspension button state
            function updateSuspensionButton() {
                const btn = document.getElementById('toggle-suspension');
                if (gameState.isTwoMinuteSuspension) {
                    btn.textContent = `2' Suspension (${gameState.suspensionTeam})`;
                    btn.classList.add('suspension-active');
                } else {
                    btn.textContent = "2' Suspension Inactive";
                    btn.classList.remove('suspension-active');
                }
            }
            
            // Initialize game timer
            function startTimer() {
                setInterval(function() {
                    gameState.seconds++;
                    updateTimeDisplay();
                }, 1000);
            }
            
            // Set up event listener for toggling suspension
            document.getElementById('toggle-suspension').addEventListener('click', function() {
                gameState.isTwoMinuteSuspension = !gameState.isTwoMinuteSuspension;
                if (gameState.isTwoMinuteSuspension) {
                    gameState.suspensionTeam = 'A'; // Default to Team A, can be changed
                    gameState.suspensionEndTime = gameState.seconds + 120; // 2 minutes
                } else {
                    gameState.suspensionTeam = null;
                }
                updateSuspensionButton();
            });
            
            // Set up event listeners for timeout buttons
            document.getElementById('timeout-button-a').addEventListener('click', function() {
                callTimeout('A');
            });
            
            document.getElementById('timeout-button-b').addEventListener('click', function() {
                callTimeout('B');
            });
            
            // Initialize the tables and timer
            initializeTables();
            startTimer();
            updatePeriodHighlight();
            updateSuspensionButton();
        });
    </script>
</body>
</html>

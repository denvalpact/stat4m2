<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Match Statistics Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            font-size: 10px;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .form-container {
            width: 100%;
            max-width: 1100px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .match-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .team-info {
            display: flex;
            gap: 10px;
        }
        
        .columns-container {
            display: flex;
            width: 100%;
            gap: 10px;
        }
        
        .team-column {
            width: 50%;
            box-sizing: border-box;
        }
        
        .team-a-column {
            padding-right: 5px;
        }
        
        .team-b-column {
            padding-left: 5px;
        }
        
        .stat-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            margin-bottom: 10px;
        }
        
        .stat-table, .stat-table th, .stat-table td {
            border: 1px solid black;
        }
        
        .stat-table th, .stat-table td {
            padding: 3px;
            text-align: center;
            height: 20px;
        }
        
        .stat-table td {
            cursor: pointer;
            position: relative;
        }
        
        .stat-cell {
            transition: background-color 0.2s;
        }
        
        .stat-cell:active {
            background-color: #ddd;
        }
        
        .small-col {
            width: 20px;
        }
        
        .medium-col {
            width: 25px;
        }
        
        .name-col {
            width: 70px;
        }
        
        .team-a {
            background-color: #e6f7ff;
        }
        
        .team-b {
            background-color: #fff2e6;
        }
        
        .controls {
            margin: 10px 0;
            padding: 5px;
            border: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        button {
            cursor: pointer;
            padding: 3px 6px;
            font-size: 10px;
        }
        
        .team-title {
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            font-size: 12px;
        }
        
        .active-period {
            background-color: #ffeb3b;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .suspension-active {
            background-color: #ffcdd2;
        }
        
        .red-card {
            background-color: #ff0000;
            color: white;
            font-weight: bold;
        }
        
        .yellow-card {
            background-color: #ffff00;
            font-weight: bold;
        }
        
        .timeout-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 5px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
        }
        
        .timeout-team {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .timeout-count {
            font-weight: bold;
            min-width: 20px;
            text-align: center;
        }
        
        .timeout-button {
            padding: 2px 5px;
            font-size: 9px;
        }
        
        .timeout-disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .timeout-active {
            background-color: #ffeb3b;
            font-weight: bold;
        }
        
        .timeout-timer {
            margin-left: 5px;
            font-weight: bold;
        }
        
        .quick-actions {
            display: flex;
            gap: 5px;
        }
        
        .quick-action-btn {
            padding: 2px 5px;
            font-size: 9px;
        }
        
        .team-totals {
            font-weight: bold;
            margin-top: 5px;
            text-align: center;
        }
        
        .highlight {
            animation: highlight 1s;
        }
        
        @keyframes highlight {
            0% { background-color: #ffff99; }
            100% { background-color: transparent; }
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="header">ENHANCED MATCH STATISTICS</div>
        
        <div class="match-info">
            <div class="team-info">
                <div><strong>Team A</strong> vs <strong>Team B</strong></div>
                <div><strong>Date:</strong> <span id="match-date">2023-11-15</span></div>
            </div>
            <div><strong>Match No.:</strong> <span id="match-number">10765</span></div>
        </div>
        
        <!-- Timeout Controls -->
        <div class="timeout-controls">
            <div class="timeout-team">
                <span>Team A Timeouts:</span>
                <span id="timeout-count-a" class="timeout-count">3</span>
                <button id="timeout-button-a" class="timeout-button">Call Timeout</button>
                <span id="timeout-timer-a" class="timeout-timer"></span>
            </div>
            <div class="timeout-team">
                <span>Team B Timeouts:</span>
                <span id="timeout-count-b" class="timeout-count">3</span>
                <button id="timeout-button-b" class="timeout-button">Call Timeout</button>
                <span id="timeout-timer-b" class="timeout-timer"></span>
            </div>
        </div>
        
        <div class="time-markers">
            <div id="period-1H">Half-time(30')</div>
            <div id="period-2H">End of 60'</div>
            <div id="period-ET1">1st extra time</div>
            <div id="period-ET2">2nd extra time</div>
        </div>
        
        <div class="controls">
            <div>
                <span id="game-time">
                    <strong>Time:</strong> 
                    <span id="match-time">00:00</span>
                    <span id="current-period" class="active-period">1H</span>
                </span>
                <button id="toggle-suspension" class="suspension-active">2' Suspension Active</button>
            </div>
            <div class="quick-actions">
                <button id="undo-btn" class="quick-action-btn" title="Undo last action">↩ Undo</button>
                <button id="redo-btn" class="quick-action-btn" title="Redo last action">↪ Redo</button>
            </div>
        </div>
        
        <!-- Two Column Layout -->
        <div class="columns-container">
            <!-- Team A Column (Left) -->
            <div class="team-column team-a-column">
                <div class="team-title">TEAM A</div>
                <table class="stat-table" id="stats-table-a">
                    <thead>
                        <tr>
                            <th class="small-col">No.</th>
                            <th class="name-col">Name</th>
                            <th class="small-col">Shirt</th>
                            <th class="small-col">Goals</th>
                            <th class="small-col">Assists</th>
                            <th class="small-col">2'</th>
                            <th class="small-col">Yellow</th>
                            <th class="small-col">Red</th>
                            <th class="small-col">Steals</th>
                            <th class="small-col">Blocks</th>
                            <th class="small-col">Turnovers</th>
                        </tr>
                    </thead>
                    <tbody id="stats-body-a">
                        <!-- Rows will be added dynamically -->
                    </tbody>
                </table>
                <div class="team-totals" id="team-a-totals">Total Goals: 0 | Assists: 0 | 2': 0</div>
            </div>
            
            <!-- Team B Column (Right) -->
            <div class="team-column team-b-column">
                <div class="team-title">TEAM B</div>
                <table class="stat-table" id="stats-table-b">
                    <thead>
                        <tr>
                            <th class="small-col">No.</th>
                            <th class="name-col">Name</th>
                            <th class="small-col">Shirt</th>
                            <th class="small-col">Goals</th>
                            <th class="small-col">Assists</th>
                            <th class="small-col">2'</th>
                            <th class="small-col">Yellow</th>
                            <th class="small-col">Red</th>
                            <th class="small-col">Steals</th>
                            <th class="small-col">Blocks</th>
                            <th class="small-col">Turnovers</th>
                        </tr>
                    </thead>
                    <tbody id="stats-body-b">
                        <!-- Rows will be added dynamically -->
                    </tbody>
                </table>
                <div class="team-totals" id="team-b-totals">Total Goals: 0 | Assists: 0 | 2': 0</div>
            </div>
        </div>
        
        <div class="match-info" style="margin-top: 10px;">
            <div>
                <strong>Referees:</strong> 
                <span id="referee1">John Smith</span>, 
                <span id="referee2">Michael Johnson</span>
            </div>
            <div>
                <strong>City:</strong> <span id="city">Berlin</span>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sample player data (would be provided before match)
            const players = {
                A: [
                    { id: 1, name: "Player A1", number: 7, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 2, name: "Player A2", number: 9, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    // ... more players ...
                ],
                B: [
                    { id: 1, name: "Player B1", number: 1, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    { id: 2, name: "Player B2", number: 2, goals: 0, assists: 0, twoMinutes: 0, yellowCards: 0, redCard: false, steals: 0, blocks: 0, turnovers: 0 },
                    // ... more players ...
                ]
            };

            // Game state
            let gameState = {
                seconds: 0,
                period: '1H',
                isTwoMinuteSuspension: false,
                suspensionTeam: null,
                suspensionEndTime: 0,
                timeouts: {
                    A: 3,
                    B: 3
                },
                isTimeoutActive: false,
                timeoutTeam: null,
                timeoutStartTime: 0,
                timeoutEndTime: 0,
                timeoutTimer: null
            };

            // Undo/Redo functionality
            let actionHistory = [];
            let currentHistoryIndex = -1;

            // Initialize tables with player data
            function initializeTables() {
                renderTeamTable('A');
                renderTeamTable('B');
                setupCellClickHandlers();
                updateTeamTotals('A');
                updateTeamTotals('B');
            }

            // Render team table
            function renderTeamTable(team) {
                const tbody = document.getElementById(`stats-body-${team.toLowerCase()}`);
                tbody.innerHTML = '';
                
                players[team].forEach((player, index) => {
                    const tr = document.createElement('tr');
                    if (player.redCard) {
                        tr.classList.add('red-card');
                    }
                    tr.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${player.name}</td>
                        <td>${player.number}</td>
                        <td class="stat-cell" data-stat="goals" data-player-id="${player.id}" data-team="${team}">${player.goals}</td>
                        <td class="stat-cell" data-stat="assists" data-player-id="${player.id}" data-team="${team}">${player.assists}</td>
                        <td class="stat-cell" data-stat="twoMinutes" data-player-id="${player.id}" data-team="${team}">${player.twoMinutes}</td>
                        <td class="stat-cell" data-stat="yellowCards" data-player-id="${player.id}" data-team="${team}" ${player.yellowCards > 0 ? 'class="yellow-card"' : ''}>${player.yellowCards}</td>
                        <td class="stat-cell" data-stat="redCard" data-player-id="${player.id}" data-team="${team}">${player.redCard ? 'X' : ''}</td>
                        <td class="stat-cell" data-stat="steals" data-player-id="${player.id}" data-team="${team}">${player.steals}</td>
                        <td class="stat-cell" data-stat="blocks" data-player-id="${player.id}" data-team="${team}">${player.blocks}</td>
                        <td class="stat-cell" data-stat="turnovers" data-player-id="${player.id}" data-team="${team}">${player.turnovers}</td>
                    `;
                    tbody.appendChild(tr);
                });
            }

            // Setup click handlers for all stat cells
            function setupCellClickHandlers() {
                // Add click handlers to all stat cells
                document.querySelectorAll('.stat-cell').forEach(cell => {
                    // Left click - increment
                    cell.addEventListener('click', (e) => {
                        if (e.button === 0) { // Left click only
                            handleStatChange(cell, 1);
                        }
                    });

                    // Right click - decrement
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleStatChange(cell, -1);
                    });

                    // Touch devices - long press for decrement
                    let pressTimer;
                    cell.addEventListener('touchstart', (e) => {
                        pressTimer = setTimeout(() => {
                            handleStatChange(cell, -1);
                        }, 300); // 300ms for long press
                    });

                    cell.addEventListener('touchend', (e) => {
                        clearTimeout(pressTimer);
                    });

                    cell.addEventListener('touchmove', (e) => {
                        clearTimeout(pressTimer);
                    });
                });
            }

            // Handle stat change (increment/decrement)
            function handleStatChange(cell, change) {
                const team = cell.getAttribute('data-team');
                const playerId = parseInt(cell.getAttribute('data-player-id'));
                const stat = cell.getAttribute('data-stat');
                const player = players[team].find(p => p.id === playerId);

                if (!player || (player.redCard && stat !== 'redCard')) return;

                // Save current state for undo
                saveStateBeforeChange();

                // Special handling for different stats
                switch(stat) {
                    case 'twoMinutes':
                        updateTwoMinutes(player, cell, change, team);
                        break;
                        
                    case 'yellowCards':
                        updateYellowCards(player, cell, change);
                        break;
                        
                    case 'redCard':
                        updateRedCard(player, cell, team, playerId);
                        break;
                        
                    default:
                        updateRegularStat(player, cell, stat, change);
                        break;
                }

                // Update team totals
                updateTeamTotals(team);

                // Highlight the changed cell
                cell.classList.add('highlight');
                setTimeout(() => {
                    cell.classList.remove('highlight');
                }, 1000);
            }

            function updateTwoMinutes(player, cell, change, team) {
                const newTwoMinutes = player.twoMinutes + change;
                if (newTwoMinutes >= 0 && newTwoMinutes <= 3) {
                    player.twoMinutes = newTwoMinutes;
                    cell.textContent = player.twoMinutes;
                    
                    // Check for red card (3 two-minute suspensions)
                    if (player.twoMinutes >= 3) {
                        player.redCard = true;
                        document.querySelector(`[data-stat="redCard"][data-player-id="${player.id}"][data-team="${team}"]`).textContent = 'X';
                        document.querySelector(`#stats-body-${team.toLowerCase()} tr:nth-child(${player.id})`).classList.add('red-card');
                        alert(`Player ${player.name} (${player.number}) received a red card for 3 two-minute suspensions!`);
                    }
                }
            }

            function updateYellowCards(player, cell, change) {
                const newYellowCards = player.yellowCards + change;
                if (newYellowCards >= 0 && newYellowCards <= 2) {
                    player.yellowCards = newYellowCards;
                    cell.textContent = player.yellowCards;
                    cell.classList.toggle('yellow-card', player.yellowCards > 0);
                    
                    // Check if player already has 2 yellow cards
                    if (player.yellowCards >= 2) {
                        alert(`Player ${player.name} (${player.number}) has received 2 yellow cards!`);
                    }
                }
            }

            function updateRedCard(player, cell, team, playerId) {
                player.redCard = !player.redCard;
                cell.textContent = player.redCard ? 'X' : '';
                document.querySelector(`#stats-body-${team.toLowerCase()} tr:nth-child(${playerId})`).classList.toggle('red-card', player.redCard);
            }

            function updateRegularStat(player, cell, stat, change) {
                const newValue = player[stat] + change;
                if (newValue >= 0) {
                    player[stat] = newValue;
                    cell.textContent = player[stat];
                }
            }

            // Update team totals
            function updateTeamTotals(team) {
                const goals = players[team].reduce((sum, player) => sum + player.goals, 0);
                const assists = players[team].reduce((sum, player) => sum + player.assists, 0);
                const twoMinutes = players[team].reduce((sum, player) => sum + player.twoMinutes, 0);
                
                document.getElementById(`team-${team.toLowerCase()}-totals`).textContent = 
                    `Total Goals: ${goals} | Assists: ${assists} | 2': ${twoMinutes}`;
            }

            // Save state before making changes (for undo)
            function saveStateBeforeChange() {
                // Truncate the history if we're not at the end
                if (currentHistoryIndex < actionHistory.length - 1) {
                    actionHistory = actionHistory.slice(0, currentHistoryIndex + 1);
                }
                
                // Save current state
                const state = {
                    players: {
                        A: JSON.parse(JSON.stringify(players.A)),
                        B: JSON.parse(JSON.stringify(players.B))
                    }
                };
                
                actionHistory.push(state);
                currentHistoryIndex = actionHistory.length - 1;
                
                // Update undo/redo button states
                updateUndoRedoButtons();
            }

            // Undo last action
            function undoAction() {
                if (currentHistoryIndex <= 0) return;
                
                currentHistoryIndex--;
                const state = actionHistory[currentHistoryIndex];
                
                // Restore player states
                players.A = JSON.parse(JSON.stringify(state.players.A));
                players.B = JSON.parse(JSON.stringify(state.players.B));
                
                // Re-render tables
                renderTeamTable('A');
                renderTeamTable('B');
                setupCellClickHandlers();
                
                // Update totals
                updateTeamTotals('A');
                updateTeamTotals('B');
                
                // Update undo/redo button states
                updateUndoRedoButtons();
            }

            // Redo last undone action
            function redoAction() {
                if (currentHistoryIndex >= actionHistory.length - 1) return;
                
                currentHistoryIndex++;
                const state = actionHistory[currentHistoryIndex];
                
                // Restore player states
                players.A = JSON.parse(JSON.stringify(state.players.A));
                players.B = JSON.parse(JSON.stringify(state.players.B));
                
                // Re-render tables
                renderTeamTable('A');
                renderTeamTable('B');
                setupCellClickHandlers();
                
                // Update totals
                updateTeamTotals('A');
                updateTeamTotals('B');
                
                // Update undo/redo button states
                updateUndoRedoButtons();
            }

            // Update undo/redo button states
            function updateUndoRedoButtons() {
                document.getElementById('undo-btn').disabled = currentHistoryIndex <= 0;
                document.getElementById('redo-btn').disabled = currentHistoryIndex >= actionHistory.length - 1;
            }

            // Call a timeout for a team
            function callTimeout(team) {
                if (gameState.timeouts[team] <= 0) {
                    alert(`Team ${team} has no timeouts remaining!`);
                    return;
                }

                if (gameState.isTimeoutActive) {
                    alert('A timeout is already active!');
                    return;
                }

                // Start the timeout
                gameState.isTimeoutActive = true;
                gameState.timeoutTeam = team;
                gameState.timeouts[team]--;
                gameState.timeoutStartTime = gameState.seconds;
                gameState.timeoutEndTime = gameState.seconds + 60; // 60 seconds = 1 minute

                // Update UI
                document.getElementById(`timeout-count-${team}`).textContent = gameState.timeouts[team];
                document.getElementById(`timeout-button-${team}`).classList.add('timeout-disabled');
                document.getElementById(`timeout-button-${team === 'A' ? 'B' : 'A'}`).classList.add('timeout-disabled');
                document.getElementById(`timeout-button-${team}`).classList.add('timeout-active');

                // Start timeout timer
                gameState.timeoutTimer = setInterval(updateTimeoutTimer, 1000);
                updateTimeoutTimer();

                alert(`Team ${team} called a timeout (1 minute). Remaining timeouts: ${gameState.timeouts[team]}`);
            }

            // Update timeout timer display
            function updateTimeoutTimer() {
                if (!gameState.isTimeoutActive) return;

                const remainingSeconds = gameState.timeoutEndTime - gameState.seconds;
                if (remainingSeconds <= 0) {
                    endTimeout();
                    return;
                }

                const minutes = Math.floor(remainingSeconds / 60);
                const seconds = remainingSeconds % 60;
                document.getElementById(`timeout-timer-${gameState.timeoutTeam}`).textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }

            // End the current timeout
            function endTimeout() {
                if (!gameState.isTimeoutActive) return;

                clearInterval(gameState.timeoutTimer);
                gameState.isTimeoutActive = false;
                
                // Reset UI
                document.getElementById(`timeout-button-A`).classList.remove('timeout-disabled', 'timeout-active');
                document.getElementById(`timeout-button-B`).classList.remove('timeout-disabled', 'timeout-active');
                document.getElementById(`timeout-timer-A`).textContent = '';
                document.getElementById(`timeout-timer-B`).textContent = '';
                
                // If team has no timeouts left, disable their button
                if (gameState.timeouts['A'] <= 0) {
                    document.getElementById(`timeout-button-A`).classList.add('timeout-disabled');
                }
                if (gameState.timeouts['B'] <= 0) {
                    document.getElementById(`timeout-button-B`).classList.add('timeout-disabled');
                }

                alert(`Timeout for Team ${gameState.timeoutTeam} has ended. Game resumes.`);
                gameState.timeoutTeam = null;
            }

            // Update game time display
            function updateTimeDisplay() {
                const periodSeconds = gameState.seconds % 1800; // 30 minutes per period
                const minutes = Math.floor(periodSeconds / 60);
                const seconds = periodSeconds % 60;
                
                document.getElementById('match-time').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Update period based on time
                if (gameState.seconds < 1800) {
                    gameState.period = '1H';
                } else if (gameState.seconds < 3600) {
                    gameState.period = '2H';
                } else if (gameState.seconds < 3900) {
                    gameState.period = 'ET1';
                } else {
                    gameState.period = 'ET2';
                }
                
                updatePeriodHighlight();
                
                // Check if 2-minute suspension has ended
                if (gameState.isTwoMinuteSuspension && gameState.seconds >= gameState.suspensionEndTime) {
                    gameState.isTwoMinuteSuspension = false;
                    gameState.suspensionTeam = null;
                    updateSuspensionButton();
                }
                
                // Update timeout timer if active
                if (gameState.isTimeoutActive) {
                    updateTimeoutTimer();
                }
            }
            
            // Highlight current period
            function updatePeriodHighlight() {
                document.querySelectorAll('.time-markers div').forEach(el => {
                    el.classList.remove('active-period');
                });
                document.getElementById(`period-${gameState.period}`).classList.add('active-period');
                document.getElementById('current-period').textContent = gameState.period;
            }
            
            // Update suspension button state
            function updateSuspensionButton() {
                const btn = document.getElementById('toggle-suspension');
                if (gameState.isTwoMinuteSuspension) {
                    btn.textContent = `2' Suspension (${gameState.suspensionTeam})`;
                    btn.classList.add('suspension-active');
                } else {
                    btn.textContent = "2' Suspension Inactive";
                    btn.classList.remove('suspension-active');
                }
            }
            
            // Initialize game timer
            function startTimer() {
                setInterval(function() {
                    gameState.seconds++;
                    updateTimeDisplay();
                }, 1000);
            }
            
            // Set up event listeners
            document.getElementById('toggle-suspension').addEventListener('click', function() {
                gameState.isTwoMinuteSuspension = !gameState.isTwoMinuteSuspension;
                if (gameState.isTwoMinuteSuspension) {
                    gameState.suspensionTeam = 'A'; // Default to Team A, can be changed
                    gameState.suspensionEndTime = gameState.seconds + 120; // 2 minutes
                } else {
                    gameState.suspensionTeam = null;
                }
                updateSuspensionButton();
            });
            
            document.getElementById('timeout-button-a').addEventListener('click', function() {
                callTimeout('A');
            });
            
            document.getElementById('timeout-button-b').addEventListener('click', function() {
                callTimeout('B');
            });
            
            document.getElementById('undo-btn').addEventListener('click', undoAction);
            document.getElementById('redo-btn').addEventListener('click', redoAction);
            
            // Initialize the tables and timer
            initializeTables();
            startTimer();
            updatePeriodHighlight();
            updateSuspensionButton();
            updateUndoRedoButtons();
        });
    </script>
</body>
</html>